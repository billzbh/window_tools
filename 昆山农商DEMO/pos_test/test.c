/*-------------------------------------------

	Name		:	test.c
	Description	:	
	Author		:	yanghb@keyou.cn
	Version		:	v1.0

---------------------------------------------*/

#include "kdm_api.h"

#if 1

// 定义密码键盘接收到密钥分发器的数据包(注：数据包长度不定长)
// 编号：	term012
// 主密钥：	12345678901234567890123456789012

unsigned char pack[77] = {
0xc0,'2',0x52,64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
't','e','r','m','0','1','2',0,0,0,0,0,0,0,0,0,0,0,0,0,
0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,
16,
0x7D,0x44,0xCB,0xE5,0xD7,0x82,0xCA,0xC8,0x19,0xAB,0xAE,0x1C,0xD6,0x11,0x03,0x0A,
0x60,0xC1,0x52,0xc0
};

/*
// 测试数据2
// 编号：	term01
// 主密钥：	12345678901234567890123456789012

unsigned char pack[77] = {
0xc0,'2',0x52,64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
't','e','r','m','0','1',0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,
16,
0x83,0xAE,0x03,0x72,0xF4,0x2C,0x8D,0x90,0xB7,0xA1,0xEE,0xCE,0x9A,0xAE,0x48,0xFD,
0x60,0xC1,0x52,0xc0
};
*/

// 定义密码键盘更新主密钥时的时间
unsigned char time[] = "100312103048"; // 10年3月12日10时30分48秒

// 终端(密码键盘)编号
char Deviceid[20];

// 终端(密码键盘)主密钥
char tmk[48];


// test
int main(void)
{
	unsigned char i = 0;

//	while(没有收到完整的数据包)
//	{
//	   接收串口数据，填入pack;
//	}
	i = dispatchData(77,pack,Deviceid,tmk); // 收到77字节的数据包后处理

//	写入编号
//	写入主密钥

	i = assembleMsg(1,12,time,pack); // (成功)返回的时间信息封装数据包
//	i = assembleMsg(0,12,time,pack); // (失败)

//	将长度为i的数据包pack,通过串口发送给密钥分发器

	while(1);
	return 0;
}

#endif
